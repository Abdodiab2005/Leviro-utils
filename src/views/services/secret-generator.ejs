<div class="max-w-2xl mx-auto">
  <div
    class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 md:p-12"
  >
    <div class="text-center mb-10">
      <div
        class="w-16 h-16 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-6"
      >
        <i class="fa-solid fa-user-secret text-3xl"></i>
      </div>
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Secret Generator</h1>
      <p class="text-gray-600">
        Generate secure secrets using server-side cryptography.
      </p>
    </div>

    <div class="space-y-8">
      <!-- Length Slider -->
      <div class="bg-gray-50 p-6 rounded-xl">
        <div class="flex justify-between mb-2">
          <label class="font-medium text-gray-700"
            >Secret Length</label
          >
          <span id="lengthValue" class="font-mono text-purple-600 font-bold"
            >32</span
          >
        </div>
        <input
          type="range"
          id="length"
          min="8"
          max="255"
          value="32"
          class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
        />
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>8</span>
          <span>255</span>
        </div>
      </div>

      <div class="relative">
        <div
          class="bg-gray-50 p-4 rounded-xl border border-gray-200 break-all font-mono text-lg text-gray-800 min-h-14 flex items-center"
          id="result"
        >
          Click generate
        </div>
        <button
          id="copyBtn"
          class="absolute top-2 right-2 p-2 text-gray-400 hover:text-purple-600 transition-colors"
          title="Copy to clipboard"
        >
          <i class="fa-regular fa-copy text-xl"></i>
        </button>
      </div>

      <button
        id="generateBtn"
        class="w-full bg-purple-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-purple-700 transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Generate Secret
      </button>

      <p class="text-xs text-center text-gray-400">
        Rate limit: 50 requests per 15 minutes.
      </p>
    </div>
  </div>
</div>

<script>
  const resultEl = document.getElementById("result");
  const generateBtn = document.getElementById("generateBtn");
  const copyBtn = document.getElementById("copyBtn");
  const lengthSlider = document.getElementById("length");
  const lengthValue = document.getElementById("lengthValue");

  lengthSlider.addEventListener("input", (e) => {
    lengthValue.textContent = e.target.value;
  });

  async function generate() {
    generateBtn.disabled = true;
    resultEl.textContent = "Generating...";
    resultEl.classList.remove("text-red-500"); // Remove error styling if present

    try {
      const length = lengthSlider.value;
      const res = await fetch("/api/secret/generate", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          length: parseInt(length),
        }),
      });

      if (!res.ok) {
        if (res.status === 429) {
          throw new Error("Too many requests. Please try again later.");
        }
        throw new Error("Failed to generate secret");
      }

      const data = await res.json();
      resultEl.textContent = data.secret;
    } catch (err) {
      resultEl.textContent = err.message;
      resultEl.classList.add("text-red-500");
      setTimeout(() => resultEl.classList.remove("text-red-500"), 3000);
    } finally {
      generateBtn.disabled = false;
    }
  }

  generateBtn.addEventListener("click", generate);

  // Initial generation
  generate();

  copyBtn.addEventListener("click", () => {
    const text = resultEl.textContent;
    if (
      text &&
      text !== "Generating..." &&
      text !== "Click generate" &&
      !text.includes("Error") &&
      !text.includes("Too many")
    ) {
      navigator.clipboard.writeText(text).then(() => {
        const originalIcon = copyBtn.innerHTML;
        copyBtn.innerHTML = `<i class="fa-solid fa-check text-green-500 text-xl"></i>`;
        setTimeout(() => {
          copyBtn.innerHTML = originalIcon;
        }, 2000);
      });
    }
  });
</script>
